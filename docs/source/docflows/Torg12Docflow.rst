.. _torg12-docflow:

Документооборот накладных
=========================

Процесс обмена электронными накладными в Диадоке реализован с учетом `Приказа ФНС России от 21 марта 2012 № ММВ-7-6/172@ <https://normativ.kontur.ru/document?moduleId=1&documentId=261859>`__.

.. note::
    Подробнее про электронные накладные можно прочитать `здесь <http://www.diadoc.ru/docs/others/tn>`__

Форматы
-------

Электронные накладные в Диадоке можно создавать по формату, утвержденному приказом ФНС `от 21 марта 2012 № ММВ-7-6/172@ <https://normativ.kontur.ru/document?moduleId=1&documentId=261859>`__, с учетом внесенных изменений приказом `от 2 февраля 2015 г. N ММВ-7-15/40@ <https://normativ.kontur.ru/document?moduleId=1&documentId=248109>`__.

В силу приказов `№ ММВ-7-6/172@ <https://normativ.kontur.ru/document?moduleId=1&documentId=261859>`__ и `N ММВ-7-15/40@ <https://normativ.kontur.ru/document?moduleId=1&documentId=248109>`__ электронная товарная накладная может быть в следующем формате:

-  :download:`XSD-схема титула продавца электронной накладной <../xsd/DP_OTORG12_1_986_00_05_01_02.xsd>`; 

-  :download:`XSD-схема титула покупателя электронной накладной <../xsd/DP_PDOTPR_1_983_00_01_01_02.xsd>`;

Также, в силу приказа `N ММВ-7-15/155@ <https://normativ.kontur.ru/document?moduleId=1&documentId=271958>`__, утвержден электронный формат универсального передаточного документа УПД. Его можно использовать как первичный документ, подтверждающий совершение хозяйственной операции; 

-  :download:`XSD-схема формата УПД (с функцикй ДОП) <../xsd/ON_SCHFDOPPR_1_995_01_05_01_01.xsd>`;


Структуры
---------

Для документов, возникающих в ходе документооборота электронных накладных, в Диадоке зарезервированы специальные :doc:`типы сущностей <../proto/Entity message>`.

Для титула продавца электронной накладной можно использовать следующий структуры:

-  *Attachment/XmlTorg12* (приказ `№ ММВ-7-6/172@ <https://normativ.kontur.ru/document?moduleId=1&documentId=249567>`__),

-  *Attachment/UniversalTransferDocument* (УПД с функцией ДОП, *FunctionType.Basic*, `приказ N ММВ-7-15/155@ <https://normativ.kontur.ru/document?moduleId=1&documentId=271958>`__),

Для титула покупателя электронной накладной можно использовать следующий структуры:

-  *Attachment/XmlTorg12BuyerTitle* (приказ `№ ММВ-7-6/172@ <https://normativ.kontur.ru/document?moduleId=1&documentId=249567>`__),

-  *Attachment/UniversalTransferDocumentBuyerTitle* (исправление УПД с функцией ДОП, *FunctionType.Basic*, `приказ N ММВ-7-15/155@ <https://normativ.kontur.ru/document?moduleId=1&documentId=271958>`__),


Порядок обмена
--------------

.. note::
    Порядок обмена электронными накладными между компаниями через Диадок описан `здесь <https://wiki.diadoc.ru/pages/viewpage.action?pageId=1147081>`__

Схема, приведенная ниже, демонстрирует порядок обмена электронными накладными, реализованный в Диадоке:

#.  Продавец формирует титул продавца накладной XmlTorg12\ :sub:`1`\, подписывает его и направляет Покупателю.

#.  Диадок доставляет титул продавца XmlTorg12\ :sub:`1`\ до Покупателя.

#.  Покупатель получает титул продавца накладной XmlTorg12\ :sub:`1`\, и формирует в ответ титул покупателя XmlTorg12BuyerTitle\ :sub:`1`\, подписывает его и отправляет в сторону Продавца.

#.  Диадок доставляет титул покупателя XmlTorg12BuyerTitle\ :sub:`1`\ до Продавца.

#.  Если Покупатель обнаружил ошибки в полученном титуле продавца накладной, он формирует отказ в подписи XmlSignatureRejection\ :sub:`1`\, подписывает его и направляет Продавцу.

#.  Диадок доставляет отказ в подписи XmlSignatureRejection\ :sub:`1`\ до Продавца.

