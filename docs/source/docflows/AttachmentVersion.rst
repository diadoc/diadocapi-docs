Форматы документов
==================

Формат № 820
------------

Формат №820, утвержденный `Приказом ФНС России от 19.12.2018 № ММВ-7-15/820@ <https://normativ.kontur.ru/document?moduleId=1&documentId=328588&cwi=517>`__, пришел на смену формату №155 и распространяется на типы документов:

- счета-фактуры,
- накладные, акты и другие первичные документы,
- УПД.

.. rubric:: Работа в Диадоке

Для Диадока документ в формате №820 — это контейнер, внутри которого лежит информация о сделке, совершенной клиентом. Диадок ничего не знает о том, как выглядит учетная политика клиентов, и не может угадать дали ему ЭСФ, акт, накладную или УПД. По содержанию документа также нельзя однозначно отличить один тип документа от другого.

.. note::
	При отправке документа участник ЭДО всегда сам выбирает показатель «тип документа».

.. rubric:: Пример

Если продавец выставит счет-фактуру по формату согласно Приказу №820, укажет в документе функцию *СЧФ*, но тип документа в API укажет ``UniversalTransferDocument``, то Диадок визуализирует документ как УПД. Чтобы визуализация счета-фактуры была привычной, при отправке документа в API нужно указать тип ``Invoice``.

.. rubric:: Генерация и парсинг

Для документов в формате №820 используйте методы:

- `GenerateSenderTitleXml <http://api-docs.diadoc.ru/ru/latest/http/GenerateSenderTitleXml.html>`_ и `GenerateRecipientTitleXml <http://api-docs.diadoc.ru/ru/latest/http/GenerateRecipientTitleXml.html>`_ для генерации,
- `ParseTitleXml <http://api-docs.diadoc.ru/ru/latest/http/ParseTitleXml.html>`_ для парсинга.

.. table:: Соответствие типов документов и форматов документов

	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| Веб             | API                                 | Форматы               | Функция                                   | Печатная форма |
	+=================+=====================================+=======================+===========================================+================+
	| СФ              | Invoice                             | приказ №93 (устарел)  | —                                         | СФ             |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №155 (устарел) | СЧФ                                       |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №820           | СЧФ                                       |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| Исправление СФ  | InvoiceRevision                     | приказ №93 (устарел)  | —                                         | СФ             |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №155 (устарел) | СЧФ                                       |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №820           | СЧФ                                       |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| КСФ             | InvoiceCorrection                   | приказ №93 (устарел)  | —                                         | КСФ            |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №189 (устарел) | КСЧФ                                      |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №736           | КСЧФ                                      |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| Исправление КСФ | InvoiceCorrection                   | приказ №93 (устарел)  | —                                         | КСФ            |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №189 (устарел) | КСЧФ                                      |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №736           | КСЧФ                                      |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| Накладная       | XmlTorg12                           | приказ №172 (устарел) | —                                         | Накладная      |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №155 (устарел) | ДОП                                       |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №820           | ДОП                                       |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №551           | —                                         |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| Акт             | XmlAcceptanceCertificate            | приказ №172 (устарел) | —                                         | Акт            |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №155 (устарел) | ДОП                                       |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №820           | ДОП                                       |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №552           | —                                         |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| УПД             | UniversalTransferDocument           | приказ №155 (устарел) | СЧФ                                       | УПД            |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | ДОП                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СЧФДОП                                    |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №820           | СЧФ                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | ДОП                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СЧФДОП                                    |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СвРК (для версии utd820_05_01_02_hyphen)  |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СвЗК (для версии utd820_05_01_02_hyphen)  |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| Исправление УПД | UniversalTransferDocumentRevision   | приказ №155 (устарел) | СЧФ                                       | УПД            |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №820           | СЧФ                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | ДОП                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СЧФДОП                                    |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СвРК (для версии utd820_05_01_02_hyphen)  |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СвЗК (для версии utd820_05_01_02_hyphen)  |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| УКД             | UniversalCorrectionDocument         | приказ №189 (устарел) | КСЧФ                                      | УКД            |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | ДИС                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | КСЧФДИС                                   |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №736           | КСЧФ                                      |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | ДИС                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | КСЧФДИС                                   |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СвИСРК (для версии ucd736_05_01_02)       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СвИСЗК (для версии ucd736_05_01_02)       |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+
	| Исправление УКД | UniversalCorrectionDocumentRevision | приказ №189 (устарел) | КСЧФ                                      | УКД            |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | ДИС                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | КСЧФДИС                                   |                |
	|                 |                                     +-----------------------+-------------------------------------------+                |
	|                 |                                     | приказ №736           | КСЧФ                                      |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | ДИС                                       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | КСЧФДИС                                   |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СвИСРК (для версии ucd736_05_01_02)       |                |
	|                 |                                     |                       |                                           |                |
	|                 |                                     |                       | СвИСЗК (для версии ucd736_05_01_02)       |                |
	+-----------------+-------------------------------------+-----------------------+-------------------------------------------+----------------+

Возможные форматы
-----------------

Документ может быть в разных форматах, поэтому в интеграционных решениях нужно различать формат пришедшего документа, чтобы корректно обработать его на своей стороне.

Для получения акутальной информации о XSD-схеме документа введено специальное поле ``Version``. Оно есть в структурах данных :doc:`Document <../proto/Document>`, :doc:`Entity <../proto/Entity message>` и :doc:`DocumentInfo <../proto/DocumentInfo>`.

Ниже приведен неполный список версий документов. Актуальные версии документа вы можете получить с помощью метода :doc:`GetDocumentTypes <../http/GetDocumentTypes>`

.. important::
	Поле ``AttachmentVersion`` устарело, вместо него используйте поле ``Version``.

.. table:: Примеры типов и значений ``Version`` для формализованных документов

	+-------------------------+-------------------------------------+--------------------------+
	| Тип документа           | Структура                           | Возможные версии         |
	+=========================+=====================================+==========================+
	| Счет-фактура            | Invoice                             | Приказ №93 (устарел)     |
	|                         |                                     |                          |
	|                         |                                     | - invoice_05_01_01       |
	|                         |                                     | - invoice_05_01_03       |
	|                         |                                     | - invoice_05_02_01       |
	|                         |                                     |                          |
	|                         |                                     | Приказ №155 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - utd_05_01_01           |
	|                         |                                     | - utd_05_01_02           |
	|                         |                                     | - utd_05_01_04           |
	|                         |                                     | - utd_05_01_05           |
	|                         |                                     | - utd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №820              |
	|                         |                                     |                          |
	|                         |                                     | - utd820_05_01_01        |
	|                         |                                     | - utd820_05_01_01_hyphen |
	|                         |                                     | - utd820_05_01_02_hyphen |
	+-------------------------+-------------------------------------+--------------------------+
	| Исправление СФ          | InvoiceRevision                     | Приказ №93 (устарел)     |
	|                         |                                     |                          |
	|                         |                                     | - invoice_05_01_03       |
	|                         |                                     | - invoice_05_02_01       |
	|                         |                                     |                          |
	|                         |                                     | Приказ №155 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - utd_05_01_01           |
	|                         |                                     | - utd_05_01_02           |
	|                         |                                     | - utd_05_01_04           |
	|                         |                                     | - utd_05_01_05           |
	|                         |                                     | - utd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №820              |
	|                         |                                     |                          |
	|                         |                                     | - utd820_05_01_01        |
	|                         |                                     | - utd820_05_01_02_hyphen |
	+-------------------------+-------------------------------------+--------------------------+
	| Корректировочный СФ     | InvoiceCorrection                   | Приказ №93 (устарел)     |
	|                         |                                     |                          |
	|                         |                                     | - invoicecor_05_01_03    |
	|                         |                                     | - invoicecor_05_02_01    |
	|                         |                                     |                          |
	|                         |                                     | Приказ №189 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - ucd_05_01_01           |
	|                         |                                     | - ucd_05_01_02           |
	|                         |                                     | - ucd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №736              |
	|                         |                                     |                          |
	|                         |                                     | - ucd736_05_01_01        |
	|                         |                                     | - ucd736_05_01_02        |
	+-------------------------+-------------------------------------+--------------------------+
	| Исправление КСФ         | InvoiceCorrectionRevision           | Приказ №93 (устарел)     |
	|                         |                                     |                          |
	|                         |                                     | - invoicecor_05_01_03    |
	|                         |                                     | - invoicecor_05_02_01    |
	|                         |                                     |                          |
	|                         |                                     | Приказ №189 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - ucd_05_01_01           |
	|                         |                                     | - ucd_05_01_02           |
	|                         |                                     | - ucd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №736              |
	|                         |                                     |                          |
	|                         |                                     | - ucd736_05_01_01        |
	|                         |                                     | - ucd736_05_01_02        |
	+-------------------------+-------------------------------------+--------------------------+
	| Формализованный ТОРГ-12 | XmlTorg12                           | Приказ №172 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - torg12_05_01_01        |
	|                         |                                     | - torg12_05_01_02        |
	|                         |                                     |                          |
	|                         |                                     | Приказ №155 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - utd_05_01_01           |
	|                         |                                     | - utd_05_01_02           |
	|                         |                                     | - utd_05_01_04           |
	|                         |                                     | - utd_05_01_05           |
	|                         |                                     | - utd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №820              |
	|                         |                                     |                          |
	|                         |                                     | - utd820_05_01_01        |
	|                         |                                     | - utd820_05_01_01_hyphen |
	|                         |                                     | - utd820_05_01_02_hyphen |
	|                         |                                     |                          |
	|                         |                                     | Приказ №551              |
	|                         |                                     |                          |
	|                         |                                     | - tovtorg_05_01_02       |
	|                         |                                     | - tovtorg_05_01_03       |
	|                         |                                     | - tovtorg_05_02_01       |
	+-------------------------+-------------------------------------+--------------------------+
	| Формализованный акт     | XmlAcceptanceCertificate            | Приказ №172 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - act_05_01_01           |
	|                         |                                     | - act_05_01_02           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №155 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - utd_05_01_01           |
	|                         |                                     | - utd_05_01_02           |
	|                         |                                     | - utd_05_01_04           |
	|                         |                                     | - utd_05_01_05           |
	|                         |                                     | - utd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №820              |
	|                         |                                     |                          |
	|                         |                                     | - utd820_05_01_01        |
	|                         |                                     | - utd820_05_01_01_hyphen |
	|                         |                                     | - utd820_05_01_02_hyphen |
	|                         |                                     |                          |
	|                         |                                     | Приказ №552              |
	|                         |                                     |                          |
	|                         |                                     | - rezru_05_01_01         |
	|                         |                                     | - rezru_05_02_01         |
	+-------------------------+-------------------------------------+--------------------------+
	| УПД                     | UniversalTransferDocument           | Приказ №155 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - utd_05_01_01           |
	|                         |                                     | - utd_05_01_02           |
	|                         |                                     | - utd_05_01_04           |
	|                         |                                     | - utd_05_01_05           |
	|                         |                                     | - utd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №820              |
	|                         |                                     |                          |
	|                         |                                     | - utd820_05_01_01        |
	|                         |                                     | - utd820_05_01_01_hyphen |
	|                         |                                     | - utd820_05_01_02_hyphen |
	+-------------------------+-------------------------------------+--------------------------+
	| Исправление УПД         | UniversalTransferDocumentRevision   | Приказ №155 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - utd_05_01_01           |
	|                         |                                     | - utd_05_01_02           |
	|                         |                                     | - utd_05_01_04           |
	|                         |                                     | - utd_05_01_05           |
	|                         |                                     | - utd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №820              |
	|                         |                                     |                          |
	|                         |                                     | - utd820_05_01_01        |
	|                         |                                     | - utd820_05_01_01_hyphen |
	|                         |                                     | - utd820_05_01_02_hyphen |
	+-------------------------+-------------------------------------+--------------------------+
	| УКД                     | UniversalCorrectionDocument         | Приказ №189 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - ucd_05_01_01           |
	|                         |                                     | - ucd_05_01_02           |
	|                         |                                     | - ucd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №736              |
	|                         |                                     |                          |
	|                         |                                     | - ucd736_05_01_01        |
	|                         |                                     | - ucd736_05_01_02        |
	+-------------------------+-------------------------------------+--------------------------+
	| Исправление УКД         | UniversalCorrectionDocumentRevision | Приказ №189 (устарел)    |
	|                         |                                     |                          |
	|                         |                                     | - ucd_05_01_01           |
	|                         |                                     | - ucd_05_01_02           |
	|                         |                                     | - ucd_05_02_01           |
	|                         |                                     |                          |
	|                         |                                     | Приказ №736              |
	|                         |                                     |                          |
	|                         |                                     | - ucd736_05_01_01        |
	|                         |                                     | - ucd736_05_01_02        |
	+-------------------------+-------------------------------------+--------------------------+

.. table:: Типы и значения ``Version`` для неформализованных документов

	+----------------------------+------------------------+------------------+
	| Тип документа              | Структура              | Возможные версии |
	+============================+========================+==================+
	| Неформализованный документ | Nonformalized          | v1               |
	+----------------------------+------------------------+------------------+
	| Приглашение к ЭДО          | TrustConnectionRequest | v1               |
	+----------------------------+------------------------+------------------+
	| Неформализованный ТОРГ-12  | Torg12                 | v1               |
	+----------------------------+------------------------+------------------+
	| Неформализованный акт      | AcceptanceCertificate  | v1               |
	+----------------------------+------------------------+------------------+
	| Счет                       | ProformaInvoice        | v1               |
	+----------------------------+------------------------+------------------+
	| Ценовой лист               | PriceList              | v1               |
	+----------------------------+------------------------+------------------+
	| Протокол согласования цены | PriceListAgreement     | v1               |
	+----------------------------+------------------------+------------------+
	| Реестр сертификатов        | CertificateRegistry    | v1               |
	+----------------------------+------------------------+------------------+
	| Акт сверки                 | ReconciliationAct      | v1               |
	+----------------------------+------------------------+------------------+
	| Договор                    | Contract               | v1               |
	+----------------------------+------------------------+------------------+
	| Накладная                  | Torg13                 | v1               |
	+----------------------------+------------------------+------------------+
	| Детализация                | ServiceDetails         | v1               |
	+----------------------------+------------------------+------------------+
	| Доп. соглашение            | SupplementaryAgreement | v1               |
	+----------------------------+------------------------+------------------+
	
.. rubric:: Добавление новых версий

В Диадоке будут добавляться новые значения ``Version`` при обновлениях форматов формализованных документов ФНС. Поэтому мы рекомендуем в интеграционных решениях обрабатывать ситуации, когда методы API вернут новое значение ``Version``.
