.. _utd-docflow:

Документооборот УПД
===================

Приказом ФНС России от `24.03.2016 №ММВ-7-15/155@ <https://normativ.kontur.ru/document?moduleId=1&documentId=271958>`__, утвержден электронный формат универсального передаточного документа УПД.

.. note::
    Подробнее про УПД можно прочитать `здесь <http://www.diadoc.ru/docs/upd>`__

Новый формат документа можно будет использовать:

- как счет-фактуру;

- как первичный документ, подтверждающий совершение хозяйственной операции;

- как универсальный передаточный документы (УПД), который совмещает в себе счет-фактуру и первичный документ, подтверждающий совершение хозяйственной операции.

.. note::
	Форма универсального передаточного документа, а также рекомендации по его заполнению приведены в письме ФНС России `от 21.10.13 № ММВ-20-3/96@ <https://normativ.kontur.ru/document?moduleId=1&documentId=220334>`__.

.. warning::
	При этом в приказе оговорено, что электронные счета-фактуры можно будет создавать как по старому формату (утв. приказом ФНС `от 04.03.15 № ММВ-7-6/93@ <https://normativ.kontur.ru/document?moduleId=1&documentId=249567>`__), так и по новому (утв. приказом ФНС России от `24.03.2016 №ММВ-7-15/155@ <https://normativ.kontur.ru/document?moduleId=1&documentId=271958>`__) вплоть до 1 июля 2017 года. А прием налоговыми органами таких счетов-фактур должен быть обеспечен до 31.12.2020 года.

Форматы
-------


УПД с функией СЧФ
-----------------

Структуры
~~~~~~~~~

Для документов, возникающих в ходе документооборота УПД с функцией СЧФ, в Диадоке зарезервированы специальные :doc:`типы сущностей <../proto/Entity message>`.

Для УПД с функцией СЧФ можно использовать следующий структуры:

-  *Attachment/UniversalTransferDocument* (*FunctionType.Invoice*),

Для исправления УПД с функцией СЧФ можно использовать следующий структуры:

-  *Attachment/UniversalTransferDocumentRevision* (*FunctionType.Invoice*),

Для корректировки УКД с функцией КСЧФ можно использовать следующий структуры:

-  *Attachment/UniversalCorrectionDocument* (*FunctionType.Invoice*),

Для исправления корректировки УКД с функцией КСЧФ можно использовать следующий структуры:

-  *Attachment/UniversalCorrectionDocumentRevision* (*FunctionType.Invoice*,),

Для служебных документов, возникающих в ходе реализации порядка обмена ЭСФ, можно использовать следующий структуры:

-  *Attachment/InvoiceConfirmation* (подтверждение оператора электронного документооборота, для обоих приказов),

-  *Attachment/InvoiceCorrectionRequest* (уведомление об уточнении СФ/ИСФ/КСФ/ИКСФ, для обоих приказов),

-  *Attachment/InvoiceReceipt* (извещение о получении СФ/ИСФ/КСФ/ИКСФ, подтверждения оператора электронного документооборота или уведомления об уточнении СФ/ИСФ/КСФ/ИКСФ, для обоих приказов).

Порядок обмена
~~~~~~~~~~~~~~

В случае, когда УПД используется с функцией СЧФ (*FunctionType.Invoice*), документооборот повторяет :ref:`документооборот СФ <invoice-docflow>`.

Таким образом со стороны получателя необходимо отправить *InvoiceReceipt* на *InvoiceConfirmation* от оператора, а также отправить *InvoiceReceipt* на документ УПД.

Со стороны отправителя необходимо сформировать *InvoiceReceipt* на *InvoiceConfirmation* от оператора и получить *InvoiceReceipt* по документу УПД.


УПД с функией ДОП
-----------------

Структуры
~~~~~~~~~

Для документов, возникающих в ходе документооборота УПД с функцией ДОП, в Диадоке зарезервированы специальные :doc:`типы сущностей <../proto/Entity message>`.

Для титула продавца УПД с функцией ДОП можно использовать следующий структуры:

-  *Attachment/UniversalTransferDocument* (*FunctionType.Basic*),

Для титула покупателя УПД с функцией ДОП можно использовать следующий структуры:

-  *Attachment/UniversalTransferDocumentBuyerTitle* (*FunctionType.Basic*),

Порядок обмена
~~~~~~~~~~~~~~

В случае, когда УПД используется с функцией ДОП (*FunctionType.Basic*), документооборот повторяет документооборот :ref:`АКТов <akt-docflow>` и :ref:`ТОРГ12 <torg12-docflow>`.

Таким образом со стороны получателя необходимо сгенерировать и отправить ответный титул покупателя.


УПД с функией СЧФДОП
~~~~~~~~~~~~~~~~~~~~

В случае, когда УПД используется с функцией СЧФДОП (*FunctionType.InvoiceAndBasic*), объединяются документообороты для *FunctionType.Invoice* и *FunctionType.Basic*.

Таким образом со стороны покупателя нужно сформировать и отправить *InvoiceReceipt* на *InvoiceConfirmation*, *InvoiceReceipt* на документ УПД, а также титул покупателя.

Со стороны отправителя необходимо сформировать *InvoiceReceipt* на *InvoiceConfirmation* от оператора, получить *InvoiceReceipt* по документу, получить титул покупателя.

Подписанты
----------

Форматы УПД и УКД подразумевают расширенный набор полей для подписантов. Этот набор полей не содержится ни в сертификате, ни в данных организации.
