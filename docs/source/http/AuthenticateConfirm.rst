AuthenticateConfirm
===================

.. contents::
   :local:

Имя ресурса: **/V2/AuthenticateConfirm**

HTTP метод: **POST**

Параметры строки запроса:

-  *token*: строка, полученная в результате расшифровки тела ответа при двухфазной аутентификации по сертификату, в формате base64 (см. :doc:`Authenticate v2 <./Authenticate>`):

-  *thumbprint*: отпечаток сертификата пользователя (опциональный). Если на сервер передается одновременно и отпечаток сертификата, и сертификат в теле запроса, то отпечаток сертификата имеет более высокий приоритет. В этом случае сертификат из тела запроса игнорируется;

-  *saveBinding*: флаг для :ref:`сохранения привязки пользователя доверенного сервиса <save_binding>` (опциональный). Может принимать два значения:

   - *true* - для сохранения привязки. Данное значение можно установить только в случае двухфазной аутентификации по сертификату с ключом, полученным доверенным сервисом;

   - *false* - привязку сохранять не нужно (значение по умолчанию в случае отсутствия параметра *saveBinding*);

HTTP-заголовки:

-  ``Authorization`` с параметром *ddauth_api_client_id* (обязательный, см. раздел :doc:`Авторизация <../Authorization>`).

Тело запроса:

-  если отсутствует параметр *thumbprint*, тело запроса должно содержать :rfc:`X.509 <5280>` сертификат пользователя, сериализованный в `DER <http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf>`__.

-  если в строке запроса присутствует параметр *thumbprint*, тело запроса может быть пустым.

В случае успешного выполнения запроса, в теле ответа содержится авторизационный токен, который следует интерпретировать как строку в кодировке UTF-8.

Возможные HTTP-коды возврата:

-  200 (OK) - операция успешно завершена;

-  400 (Bad Request) - данные в запросе имеют неверный формат или отсутствуют обязательные параметры;

-  401 (Unauthorized) - в запросе отсутствует HTTP-заголовок ``Authorization``, или в этом заголовке отсутствует параметр *ddauth_api_client_id*, или переданный в нем ключ разработчика не зарегистрирован в Диадоке;

-  403 (Forbidden) - доступ запрещен;

-  405 (Method not allowed) - используется неподходящий HTTP-метод;

-  500 (Internal server error) - при обработке запроса возникла непредвиденная ошибка.

.. _save_binding:

Привязка пользователя доверенного сервиса
-----------------------------------------

При аутентификации по сертификату или логину/паролю с указанием ключа, полученного доверенным сервисом, есть возможность сохранить привязку пользователя доверенного сервиса с пользователем Диадока. Эта возможность позволяет в дальнейшем производить аутентификацию по ключу без предъявления аутентификационных данных пользователя.

Если при аутентификации был указан ключ, полученный доверенным сервисом:

- при аутентификации по логину/паролю привязка пользователя производится автоматически;

- при двухфазной аутентификации по сертификату привязка пользователя производится при указании параметра *saveBinding=true* в параметре запроса :doc:`AuthenticateConfirm`;

- привязка пользователя не поддерживается при однофазной аутентификации по сертификату;

