PostMessage
===========

Имя ресурса: **/V3/PostMessage**

HTTP метод: **POST**

Параметры строки запроса:

-  *operationId*: уникальный идентификатор операции (строка не чувствительная к регистру, может отсутствовать). Если вызов с указанным идентификатором операции завершился успехом, то и все последующие вызовы с тем же идентификатором операции так же завершатся успехом. Результат всех последующих вызовов будет равен результату первого успешного вызова. По умолчанию в качестве идентификатора операции используется MD5-хэш тела запроса.

В запросе должен присутствовать HTTP-заголовок ``Authorization`` с необходимыми данными для :doc:`авторизации <../Authorization>`.

В теле запроса должно содержаться отправляемое сообщение, сериализованное в протобуфер :doc:`../proto/MessageToPost`.

В теле ответа содержится отправленное сообщение, сериализованное в протобуфер :doc:`../proto/Message`.

Возможные HTTP-коды возврата:

-  200 (OK) - операция успешно завершена;

-  400 (Bad Request) - данные в запросе имеют неверный формат, отсутствуют обязательные параметры, превышено максимально допустимое количество документов в сообщении (текущее ограничение - 30);

-  401 (Unauthorized) - в запросе отсутствует HTTP-заголовок ``Authorization``, или в этом заголовке содержатся некорректные авторизационные данные;

-  403 (Forbidden) - доступ к ящику с предоставленным авторизационным токеном запрещен;

-  405 (Method not allowed) - используется неподходящий HTTP-метод;

-  409 (Conflict) - попытка отправить дубликат сообщения или запрет приема документов от контрагентов согласно свойству ``Sociability`` из :doc:`../proto/Organization`.

Если в ответе содержится HTTP-заголовок ``Retry-After``, то предыдущий вызов этого метода с таким же идентификатором операции еще не завершен. В этом случае следует повторить вызов через указанное в заголовке время (в секундах), чтобы убедиться, что операция завершилась без ошибок.

-  500 (Internal server error) - при обработке запроса возникла непредвиденная ошибка.
