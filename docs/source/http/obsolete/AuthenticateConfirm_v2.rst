AuthenticateConfirm (V2)
========================

.. warning::
	Эта версия метода устарела. Используйте новую версию метода :doc:`../AuthenticateConfirm`.

Метод ``AuthenticateConfirm`` возвращает авторизационный токен после аутентификации по сертификату методом ``Authenticate``.

.. http:post:: /V2/AuthenticateConfirm

	:queryparam token: строка в формате Base64, полученная после расшифровки тела ответа метода ``Authenticate``.
	:queryparam thumbprint: отпечаток сертификата пользователя. Необязательный параметр. Если не указан, в теле запроса нужно передать сертификат пользователя, сериализованный в `DER <http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf>`__.
	:queryparam saveBinding: флаг для :ref:`сохранения привязки пользователя доверенного сервиса <save_binding_v2>`. Укажите значение ``true``, если нужно сохранить привязку. Необязательный параметр. По умолчанию имеет значение ``false``.

	:requestheader Authorization: данные, необходимые для авторизации. В заголовке нужно передать ``DiadocAuth ddauth_api_client_id``.

	:request Body: Если параметр ``thumbprint`` не указан, тело запроса должно содержать :rfc:`X.509 <5280>` сертификат пользователя, сериализованный в `DER <http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf>`__. Иначе может быть пустым.

	:statuscode 200: операция успешно завершена.
	:statuscode 400: данные в запросе имеют неверный формат или отсутствуют обязательные параметры.
	:statuscode 401: в запросе отсутствует HTTP-заголовок ``Authorization``, или в этом заголовке отсутствует параметр ``ddauth_api_client_id``, или переданный в нем ключ разработчика не зарегистрирован в Диадоке.
	:statuscode 403: доступ запрещен.
	:statuscode 405: используется неподходящий HTTP-метод.
	:statuscode 500: при обработке запроса возникла непредвиденная ошибка.

	:response Body: Тело ответа содержит авторизационный токен.

Если в метод передаются одновременно отпечаток сертификата и сертификат, то отпечаток сертификата имеет более высокий приоритет. В этом случае сертификат из тела запроса игнорируется.

.. _save_binding_v2:

Привязка пользователя доверенного сервиса
-----------------------------------------

Сохранить привязку пользователя доверенного сервиса с пользователем Диадока можно при аутентификации по сертификату или логину и паролю. Для этого в заголовке нужно указывать ключ ``X-Diadoc-ServiceKey``, полученный доверенным сервисом, и идентификатор пользователя в доверенном сервисе ``X-Diadoc-ServiceUserId``.

При аутентификации по логину и паролю привязка производится автоматически. При аутентификации по сертификату автоматическая привязка не производится: для привязки укажите параметр ``saveBinding = true``.