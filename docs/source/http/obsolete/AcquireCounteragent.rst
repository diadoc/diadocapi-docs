AcquireCounteragent
===================

.. warning::
	Эта версия метода устарела. Используйте новую версию метода :doc:`../AcquireCounteragent`.

Метод ``AcquireCounteragent`` отправляет контрагенту приглашение к партнерским отношениям. С помощью этого метода можно добавить организацию в :doc:`список активных контрагентов <../../instructions/counteragents>`.

.. http:post:: /AcquireCounteragent

	:queryparam myOrgId: идентификатор организации, от имени которой производится инициация отношения партнерства.
	:queryparam counteragentOrgId: идентификатор организации контрагента.
	:queryparam comment: текст сообщения для контрагента. Необязательный параметр, длина не более 2000 символов.
	:queryparam myDepartmentId: идентификатор подразделения, от имени которого производится инициация отношения партнерства. Необязательный параметр.

	:requestheader Authorization: данные, необходимые для :doc:`авторизации <../../Authorization>`.

	:statuscode 200: операция успешно завершена.
	:statuscode 400: данные в запросе имеют неверный формат или отсутствуют обязательные параметры.
	:statuscode 401: в запросе отсутствует HTTP-заголовок ``Authorization`` или в этом заголовке содержатся некорректные авторизационные данные.
	:statuscode 402: у организации с указанным идентификатором ``myOrgId`` закончилась подписка на API.
	:statuscode 403: доступ к ящику с предоставленным авторизационным токеном запрещен, или у пользователя недостаточно прав для доступа ко всем документам организации, или у пользователя нет права работать со списком контрагентов (см. :doc:`OrganizationUserPermissions.CanManageCounteragents <../../proto/OrganizationUserPermissions>`).
	:statuscode 404: в указанном ящике нет документов с указанными идентификаторами.
	:statuscode 405: используется неподходящий HTTP-метод.
	:statuscode 409: требуется заявка на роуминг для отправки приглашения роуминговому контрагенту (подробнее https://www.diadoc.ru/roaming).
	:statuscode 500: при обработке запроса возникла непредвиденная ошибка.

Пользователь может работать со списком контрагентов организации только если у него есть доступ к ящику этой организации.

В случае с роуминговым оператором используйте метод :doc:`../GetRoamingOperators`, чтобы узнать, поддерживает ли он автоматическую обработку приглашений.

Метод работает по следующим правилам:

	- Если между организацией ``myOrgId`` и контрагентом ``counteragentOrgId`` нет действующего отношения партнерства, то от имени организации ``myOrgId`` будет отправлен запрос на установление отношения партнерства в адрес организации контрагента. Контрагент перейдет в статус ``IsInvitedByMe``.
	- Если у организации ``myOrgId`` есть входящий запрос на установление отношения партнерства от организации контрагента ``counteragentOrgId`` (то есть контрагент находится в статусе ``InvitesMe``), то этот запрос будет подтвержден, и между организациями ``myOrgId`` и контрагентом установится действующее отношение партнерства. Контрагент перейдет в статус ``IsMyCounteragent``.
	- Если между организацией ``myOrgId`` и контрагентом ``counteragentOrgId`` отношение партнерства уже установлено или есть исходящий запрос от организации ``myOrgId`` к организации контрагента, то в результате выполнения метода ничего не произойдет.