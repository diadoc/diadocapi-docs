SignedContent
=============

Структура ``SignedContent`` предназначена для представления подписанных ЭП данных в отправляемом сообщении:

.. code-block:: protobuf

    message SignedContent {
        optional bytes Content = 1;
        optional bytes Signature = 2;
        optional string NameOnShelf = 4;
        optional bool SignWithTestSignature = 5 [default = false];
        optional string SignatureNameOnShelf = 6;
        optional PowerOfAttorneyToPost PowerOfAttorney = 7;
    }

- ``Content`` — подписываемые данные (бинарное представление документа). Должно оставаться пустым (не заполняться), если заполнено поле ``NameOnShelf``.

- ``NameOnShelf`` — имя файла с подписываемыми данными на «полке документов». Должно оставаться пустым (не заполняться), если содержимое подписанного документа размещено в поле ``Content``.

- ``Signature`` — ЭП (в некоторых случаях может отсутствовать). Если ЭП присутствует, то она должна быть представлена в формате :rfc:`CMS SignedData <5652#section-5>` в `DER <http://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf>`__-кодировке.

- ``SignWithTestSignature`` — флаг, который позволяет запросить формирование тестовой ЭП под пересылаемыми данными.

- ``SignatureNameOnShelf`` — имя подписи на «полке документов».

- ``PowerOfAttorney`` — данные машиночитаемой доверенности, представленные структурой :doc:`PowerOfAttorneyToPost`.

Следует придерживаться следующей схемы использования структуры ``SignedContent``. Если подписываемый документ имеет небольшой размер (не превышает 500Кб), его бинарное представление можно разместить непосредственно в структуре ``SignedContent`` в поле ``Content``. 
Если же размер документа не укладывается в эти ограничения, следует предварительно загрузить этот документ на «полку документов» при помощи серии вызовов :doc:`../http/ShelfUpload`, а затем указать имя документа на «полке» в поле ``NameOnShelf`` структуры ``SignedContent``.
В противном случае сервер может отказаться обрабатывать запрос, содержащий структуры ``SignedContent`` большого размера.

Ограничения на размер передаваемых документов действуют не только на уровне отдельного документа, но и на уровне запроса к серверу. А именно, если запрос к серверу содержит несколько документов (несколько структур ``SignedContent``), то суммарный размер передаваемых в рамках запроса данных не должен превышать 70Мб (с учетом передаваемой служебной информации). Поэтому для повышения устойчивости интеграционного решения использование загрузки документов через сервис «полки документов» является рекомендуемым.

----

.. rubric:: Использование

Структура ``SignedContent`` используется внутри структур :doc:`Message` и :doc:`MessageToPost` при отправке документов методами :doc:`../http/PostMessage` и :doc:`../http/PostMessagePatch`.