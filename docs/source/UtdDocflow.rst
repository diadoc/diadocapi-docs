Документооборот УПД
===================

Приказом ФНС России от `24.03.2016 №ММВ-7-15/155@ <https://normativ.kontur.ru/document?moduleId=1&documentId=271958>`__, утвержден электронный формат универсального передаточного документа УПД.


Новый формат документа можно будет использовать:

- как счет-фактуру;

- как первичный документ, подтверждающий совершение хозяйственной операции;

- как универсальный передаточный документы (УПД), который совмещает в себе счет-фактуру и первичный документ, подтверждающий совершение хозяйственной операции.

.. note::
	Форма универсального передаточного документа, а также рекомендации по его заполнению приведены в письме ФНС России `от 21.10.13 № ММВ-20-3/96@ <https://normativ.kontur.ru/document?moduleId=1&documentId=220334>`__.

.. warning::
	При этом в приказе оговорено, что электронные счета-фактуры можно будет создавать как по старому формату (утв. приказом ФНС `от 04.03.15 № ММВ-7-6/93@ <https://normativ.kontur.ru/document?moduleId=1&documentId=249567>`__), так и по новому (утв. приказом ФНС России от `24.03.2016 №ММВ-7-15/155@ <https://normativ.kontur.ru/document?moduleId=1&documentId=271958>`__) вплоть до 1 июля 2017 года. А прием налоговыми органами таких счетов-фактур должен быть обеспечен до 31.12.2020 года.

УПД с функией СЧФ
-----------------

В случае, когда УПД используется с функцией СЧФ (*FunctionType.Invoice*), документооборот повторяет :ref:`документооборот СФ <invoice-docflow>`.

То есть со стороны получателя необходимо отправить *InvoiceReceipt* на InvoiceConfirmation от оператора, а также отправить InvoiceReceipt на документ УПД. Со стороны отправителя необходимо сформировать Receipt на InvoiceConfirmation от оператора и получить InvoiceReceipt по документу УПД.

УПД с функией ДОП
-----------------

В случае `FunctionType.Basic` документооборот повторяет документооборот АКТов и ТОРГ12. То есть со стороны получателя необходимо сгенерировать и отправить титул покупателя.


УПД с функией СЧФДОП
--------------------

В случае `FunctionType.InvoiceAndBasic` объединяются документообороты для Invoice и Basic. То есть со стороны покупателя нужно сформировать и отправить InvoiceReceipt на InvoiceConfirmation, InvoiceReceipt на документ УПД, а также титул покупателя. Со стороны отправителя необходимо сформировать InvoiceReceipt на InvoiceConfirmation от оператора, получить InvoiceReceipt по документу, получить титул покупателя.

Signers
-------

Форматы УПД и УКД подразумевают расширенный набор полей для подписантов. Этот набор полей не содержится в сертификате ни в данных организации. Мы сделали метод в API с помощью которого можно будет запомнить данные подписанта в Диадоке, на данный момент эта функциональность не документирована (работа в этом направлении ведется). Когда расширенный набор полей будет сохранен в Диадоке, возможно будет использовать их автозаполнение указанием BoxId и Certificate/CertificateThumbprint без ошибки.
