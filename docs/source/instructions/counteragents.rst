Контрагенты
===========

.. contents:: :local:

Диадок предоставляет возможность работать с контрагентами.


Работа со списком активных контрагентов
---------------------------------------

**Активные контрагенты** — это :doc:`контрагенты <../entities/counteragent>`, с которыми текущая организация установила партнерские отношения. Диадок хранит список таких контрагентов и позволяет им управлять.

Список активных контрагентов сущетсвует только для удобства поиска контрагентов и не влияет на возможность обмениваться документами. Обмен документами возможен с любыми организациями — в том числе с теми, которые не входят в список активных контрагентов. Исключение составляют следующие организации:

	- Организации, установившие в своих реквизитах настройку «Документы от контрагентов» в значение «Только организации из списка "Ваши контрагенты"». В этом случае отправить документ такой организации может только организация из списка ее активных контрагентов.
	- Организации, работающие с другими операторами ЭДО.

Список активных контрагентов в `веб-интерфейсе <https://diadoc.kontur.ru>`__ Диадока упрощает пользователю выбор контрагента при выполнении операций. Кроме этого веб-интерфейс предоставляет возможность просматривать список активных контрагентов и редактировать его — приглашать контрагентов или удалять их из списка.

Та же функциональность доступна и через API. Действия, выполненные в веб-интерфейсе и через API будут зеркальными — то есть будут отражаться в обоих сервисах. Также API предоставляет возможность работать с группами контрагентов, подробнее в инструкции :doc:`counteragentgroups`.

Если ваш список активных контрагентов небольшой и редко изменяется, вы можете не реализовывать работу со списом через API в вашем интеграционном решении: достаточно перед использованием интеграционного решения настроить список через веб-интерфейс.


Получение списка активных контрагентов
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Чтобы получить текущий список активных контрагентов, используйте метод :doc:`../http/GetCounteragents`. При вызове метода не указывайте дополнительных параметров, в этом случае метод вернет весь список.

**Пример HTTP-запроса метода GetCounteragents:**

.. literalinclude:: ../include/getCounteragents_all_query.txt

**Пример тела ответа метода GetCounteragents:**

.. container:: toggle

	.. literalinclude:: ../include/getCounteragents_resp.txt
		:language: json


Приглашение контрагента к сотрудничеству
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Чтобы пригласить контрагента к сотрудничеству, используйте метод :doc:`../http/AcquireCounteragent`.

1. Вызовите метод :doc:`../http/AcquireCounteragent`. Он отправит асинхронный запрос на установление отношений сотрудничества и вернет в ответе идентификатор операции, с помощью которого вы сможете проверить, успешно ли выполнена операция.

   **Пример HTTP-запроса метода AcquireCounteragent:**

   .. literalinclude:: ../include/acquireCounteragent_query.txt

   **Пример тела запроса метода AcquireCounteragent:**

   .. container:: toggle

    .. literalinclude:: ../include/acquireCounteragent_body.txt
       :language: json

   **Пример тела ответа метода AcquireCounteragent:**

   .. literalinclude:: ../include/acquireCounteragent_resp.txt
       :language: json

2. Вызовите метод :doc:`../http/AcquireCounteragentResult`, передав ему в качестве параметра идентификатор, полученный на предыдущем этапе. В ответе метод вернет информацию об отправленном приглашении.

   **Пример HTTP-запроса метода AcquireCounteragentResult:**

   .. literalinclude:: ../include/acquireCounteragentResult_query.txt

   **Пример тела ответа метода AcquireCounteragentResult:**

   .. literalinclude:: ../include/acquireCounteragentResult_resp.txt
       :language: json

Когда ваш контрагент примет приглашение к сотрудничеству, он появится в списке активных контрагентов.


Разрыв отношений с контрагентом
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Чтобы разорвать партнерские отношения с контрагентом и удалить его из списка активных контрагентов, использйте метод :doc:`../http/BreakWithCounteragent`.

**Пример HTTP-запроса метода BreakWithCounteragent:**

.. literalinclude:: ../include/breakWithCounteragent_query.txt


Получение информации о контрагенте
----------------------------------

Чтобы получить информацию о контрагенте и статусе партнерства с ним, используйте метод :doc:`../http/GetCounteragent`.

**Пример HTTP-запроса метода GetCounteragent:**

.. literalinclude:: ../include/getCounteragent_query.txt

**Пример тела ответа метода GetCounteragent:**

.. container:: toggle

	.. literalinclude:: ../include/getCounteragent_resp.txt
		:language: json

Получить ленту событий по изменению отношений с контрагентом можно с помощью метода :doc:`../http/GetCounteragentEvents`. Подробнее в инструкции :doc:`counteragentevents`.


Получение сертификатов контрагента
----------------------------------

Если вы хотите отправить контрагенту зашифрованный документ, вам нужно выбрать сертификат, на который будет зашифрован этот документ. Для этого вы можете получить все сертификаты контрагента и выбрать из них подходящий.

.. include:: ../include/access_required_encryptedDocumentsAllowed.txt

Чтобы получить сертификаты контрагента, используйте метод :doc:`../http/GetCounteragentCertificates`.

**Пример HTTP-запроса метода GetCounteragentCertificates:**

.. literalinclude:: ../include/getCounteragentCertificates_query.txt

**Пример тела ответа метода GetCounteragentCertificates:**

.. literalinclude:: ../include/getCounteragentCertificates_resp.txt
	:language: json


Поиск контрагентов
------------------

Найти контрагентов, не входящих в список активных контрагентов, можно с помощью методов для поиска организаций:

- :doc:`../http/GetOrganizationsByInnKpp` — возвращает организации с указанными ИНН и КПП.
- :doc:`../http/GetOrganizationsByInnList` — возвращает организации и их статусы по указанному списку ИНН.
- :doc:`../http/GetBox` — по идентификатору ящика возвращает информацию об организации, которой он принадлежит.
- :doc:`../http/GetOrganization` — по идентификатору организации возвращает принадлежащий ей ящик и ее данные: например, ИНН, КПП, название и т.п.


----

.. rubric:: См. также

*Определение:*
	- :doc:`../entities/counteragent`

.. include:: ../include/seealso_instr_counteragent.txt