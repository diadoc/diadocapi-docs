Пакет документов
================

**Пакет документов** — несколько связанных между собой документов, предназначенных одному контрагенту. В пакет можно объединить документы из разных :doc:`сообщений <../entities/message>`.

Есть два типа пакетов:

	#. Открытый пакет. Документы можно обрабатывать по отдельности. Состав пакета можно менять.

	#. Закрытый пакет. С документами нельзя выполнять действия по отдельности: действие должно быть применено ко всем документам сразу. Состав пакета изменить нельзя. Существует два :doc:`режима блокировки <../proto/LockMode>` закрытого пакета:

		1. ``Send``. После отправки пакета с документами можно работать по отдельности.
		2. ``Full``. Ограничения сохраняются после отправки.
	
		Действия, на которые распространяется блокировка:

			- подписание,
			- отказ в подписи,
			- перемещение,
			- удаление,
			- восстановление,
			- согласование,
			- аннулирование,
			- создание исходящего документа из документа-шаблона,
			- отклонение и отзыв документа-шаблона.

При отправке методом :doc:`../http/PostMessage` документы автоматически формируют пакет. Каждому пакету присваивается идентификатор ``PacketId``. Чтобы добавить документ в уже существующий пакет, при отправке укажите у него ``SubordinateDocumentId`` или ``InitialDocumentId``.

	- ``SubordinateDocumentId`` — идентификатор документа, который должен ссылаться на отправляемый документ.
	- ``InitialDocumentId`` — идентификатор документа, к которому привязывается отправляемый документ.

Документ можно добавить в новый пакет после отправки. Если добавляемый документ является частью другого пакета, то в новый пакет будут добавлены все документы из старого пакета — пакеты объединяются целиком. В этом случае документу будет присвоен ``PacketId`` нового пакета. Если объединить документы из разных пакетов, то новому пакету будет присвоен новый ``PacketId``. При удалении документа из пакета ``PacketId`` меняется на новый.

Представление в API
-------------------

*Методы для работы с пакетами:*
 - :doc:`../http/GetDocflowsByPacketId_V3` — возвращает список документов, находящихся в пакете.

*Структуры для работы с пакетами:*
 - :doc:`../proto/PacketInfo` — хранит информацию о связанных документах.
 - :doc:`../proto/LockMode` — представляет собой режим блокировки сообщения с документами.
 - :doc:`EditDocumentPacketCommand <../proto/MessagePatchToPost>` — представляет собой действие по редактированию состава пакета одного из документов в сообщении.